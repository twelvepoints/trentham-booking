!function(r){var t,e,n,a,u=r.adm,o=r.location.pathname,s=Date.now?parseInt(Date.now()):(new Date).getTime(),i=new RegExp(/[-/\\^$*+?.()|[\]{}]/g),c={morethan:function(t,e){return t<e},lessthan:function(t,e){return e<t},equalto:function(t,e){return t===e},contains:function(t,e){if(t&&e&&"string"==typeof t&&"string"==typeof e)return new RegExp("\\b"+t.toUpperCase()+"\\b").test(e.toUpperCase())}},l=["url_contains","url_match","url_does_not_contain","url_does_not_match","frequency","anniversary","custom_data","time_spent"];Array.indexOf||(Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return e;return-1}),r.localStorage&&(t=r.localStorage),r.sessionStorage&&(e=r.sessionStorage);var p=t.getItem("adm.usrmeta");p?n=JSON.parse(p):(n=[{p:"ALL",d:{fq:0,lv:[s]}}],t.setItem("adm.usrmeta",JSON.stringify(n)));var f,m=b("ALL",n).d,d=b(o,n);u.customData=r.admCustomData,d=d?d.d:(f={p:o,d:{fq:0,lv:[s]}},n.push(f),t.setItem("adm.usrmeta",JSON.stringify(n)),f.d);var h=e.getItem("adm.sesh");d.fq=d.fq+1,h||(e.setItem("adm.sesh",s),m.fq=m.fq+1);var g=parseInt(d.fq),y=parseInt(m.fq);function v(){var t=new(r.XDomainRequest?XDomainRequest:XMLHttpRequest),e=u.json;t.overrideMimeType&&t.overrideMimeType("application/json"),t.open("GET",e,!0),r.XDomainRequest?(t.onload=function(){D((a=JSON.parse(t.responseText)).pixels)},t.onerror=function(){console.log("ADM Pixel Error: Cannot get JSON")}):t.onreadystatechange=function(){4==t.readyState&&"200"==t.status&&D((a=JSON.parse(t.responseText)).pixels)},setTimeout(function(){t.send(null)},0)}function D(t){for(var e,r=[u.pixid],n=t.length-1;0<=n;n--){u.processRules(t[n])&&(t[n].custom_data&&t[n].custom_data.length&&u.customData&&u.customData.length&&Object.keys(u.customData[0]).length?(e=O(t[n],u.customData[0]),_([t[n].id],e)):r.push(t[n].id))}return _(r)}function _(t,e){var r=u.pixurl+"/pixel?",n="id="+t.toString(),a=document.getElementsByTagName("head")[0],o=document.createElement("script");if(e&&1===t.length&&(n+="&"+e),n+="&t=js",o.type="text/javascript",o.src=r+n,o.async=!0,!function(t){for(var e=document.getElementsByTagName("script"),r=e.length;r--;)if(e[r].src==t)return!0;return!1}(o.src))return a.appendChild(o),o;console.log("Pixel already fired")}function O(t,e){var r=[];for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&-1<t.custom_data.indexOf(n))if("[object Array]"===Object.prototype.toString.call(e[n])){var a=e[n].join("+");if(t.rules)for(var o=0;o<t.rules.length;o++){var s=t.rules[o];-1<e[n].indexOf(s.values.value)&&(a=s.values.value)}r.push(n+"="+encodeURIComponent(a))}else r.push(n+"="+encodeURIComponent(e[n]));return r.join("&")}function b(t,e){for(var r=e.length-1;0<=r;r--)if(e[r].p===t)return e[r]}"complete"===document.readyState?v():document.onreadystatechange=function(){"complete"===document.readyState&&v()},u.getLocationHref=function(){return r.location.href},u.processRules=function(t){var e,r,n=g,a=[];if(!t||!t.rules||"[object Array]"!==Object.prototype.toString.call(t.rules))return!1;var o=t.rules;o.length<=2&&function(t){for(var e=t.length-1;0<=e;e--)if("frequency"!==t[e].type)return!1;return!0}(o)&&(n=y);for(var s=o.length-1;0<=s;s--)if(e=o[s].values,r=o[s].type,-1!==l.indexOf(r))switch(o[s].type){case"url_contains":a.push(u.urlContains(e));break;case"url_match":a.push(u.urlMatch(e));break;case"url_does_not_contain":a.push(!u.urlContains(e));break;case"url_does_not_match":a.push(!u.urlMatch(e));break;case"frequency":a.push(u.frequency(e,n));break;case"anniversary":a.push(u.anniversary(e));break;case"custom_data":a.push(u.customDataRule(e));break;case"time_spent":a.push(u.timeSpent(e,t))}return a.every(function(t){return t})},u.urlContains=function(t){if(!t||"[object Array]"!==Object.prototype.toString.call(t))return!1;for(var e=u.getLocationHref(),r=t.length-1;0<=r;r--)if(-1<e.search(new RegExp(t[r].replace(i,"\\$&"),"i")))return!0;return!1},u.urlMatch=function(t){if(!t||"[object Array]"!==Object.prototype.toString.call(t))return!1;for(var e=u.getLocationHref(),r=t.length-1;0<=r;r--)if(new RegExp("^"+t[r].replace(i,"\\$&")+"$","i").test(e))return!0;return!1},u.frequency=function(t,e){if(!t||!Object.prototype.hasOwnProperty.call(t,"operator"))return!1;var r=t.operator,n=t.value;return c[r](+n,+e)},u.anniversary=function(t){var e=(new Date).getMonth();return parseInt(t)===e},u.customDataRule=function(t){if(t&&Object.prototype.hasOwnProperty.call(t,"operator")&&u.customData&&u.customData.length&&Object.keys(u.customData[0]).length){var e=t.operator,r=t.key,n=t.value,a=u.customData[0][r];if("[object Array]"===Object.prototype.toString.call(a)&&-1!==a.indexOf(n)||!isNaN(n)&&!isNaN(a)&&c[e](+n,+a)||isNaN(n)&&c[e](n,a))return!0}return!1},u.timeSpent=function(t,e){if(!t||isNaN(t.time_spent))return!1;var r=t.time_spent;"minutes"===t.timeUnit&&(r*=60),r*=1e3;var n=[];return e.custom_data&&e.customData&&e.customData.length&&u.customData&&u.customData.length&&Object.keys(u.customData[0]).length&&(n=O(e,u.customData[0])),setTimeout(function(){_(e.id,n)},r),!1},u.track=function(t){var e;if(u.customData=r.admCustomData,t===a.id)return _([t]);u.customData&&u.customData[0]&&Object.keys(u.customData[0]).length&&(e=O(function(t){var e;if(t===a.id)return a;for(var r=0;r<a.pixels.length;r++)if(a.pixels[r].id===t){e=a.pixels[r];break}return e}(t),u.customData[0]));_([t],e)},u.__pt__=D,m.lv=d.lv=[s],t.setItem("adm.usrmeta",JSON.stringify(n))}(window);